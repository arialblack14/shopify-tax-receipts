<%= erb :"_top_bar", :layout => false, :locals => locals %>

<style>
  html,
  body {
    height: 100%;
    /* The html and body elements cannot have any padding or margin. */
  }

  /* Wrapper for page content to push down footer */
  #wrap {
    min-height: 100%;
    height: auto !important;
    height: 100%;
    /* Negative indent footer by it's height */
    margin: 0 auto -60px;
  }

  /* Set the fixed height of the footer here */
  #push,
  #footer {
    height: 60px;
  }
  #footer {
    background-color: #f5f5f5;
  }

  /* Lastly, apply responsive CSS fixes as necessary */
  @media (max-width: 767px) {
    #footer {
      margin-left: -20px;
      margin-right: -20px;
      padding-left: 20px;
      padding-right: 20px;
    }
  }
</style>

<script>
window.editEmailModal = function(){
  ShopifyApp.Modal.open({
    src: '/charity/email_template',
    title: 'Edit "Donation Receipt" Email Template',
    height: 400,
    width: 'medium',
    buttons: {
      primary: {
        label: "Save",
        callback: function(){
          ShopifyApp.Modal.window().$("form").submit();
          ShopifyApp.Modal.close("ok");
        }
      },
      secondary: [
        {
          label: "Cancel",
          callback: function(){ ShopifyApp.Modal.close(); }
        },
      ]
    },
  }, function(result){
    if (result)
      ShopifyApp.flashNotice("Email Template Saved")
  });
}
</script>

<div id="wrap">
  <div class="container">
    <h3>Tax Receipts</h3>

    <div class="well">
      <% unless @charity.present? %>
        <p>Please Enter your Charity details to complete the installation</p>
      <% end %>

      <form method="POST" action="/charity" role="form">
        <% if @charity.present? %>
          <input type="hidden" name="_method" value="put" />
        <% end %>

        <div class="form-group">
          <div class="col-sm-4">

            <div class="control-group">
              <div class="controls">
                <div class="input-prepend">
                  <span class="add-on"><i class="icon-info-sign"></i></span>
                  <input type="text" name="name" placeholder="eg. Amnesty International" <%= "value=\"#{@charity.name}\"".html_safe if @charity.present? %>>
                </div>
              </div>
            </div>

            <div class="control-group">
              <div class="controls">
                <div class="input-prepend">
                  <span class="add-on"><i class="icon-info-sign"></i></span>
                  <input type="text" name="charity_id" placeholder="BN/Registration # eg. 804" <%= "value='#{@charity.charity_id}'" if @charity.present? %>>
                </div>
              </div>
            </div>

            <div class="control-group">
              <div class="controls">
                <input type="submit" class="btn btn-default" value="save">
              </div>
            </div>

          </div>
        </div>
      </form>
    </div>

    <% if @charity.present? %>
      <a href="#" onclick="editEmailModal()">Edit receipt email template</a>
    <% end %>

    <h3>Products</h3>

    <% if @products.present? %>
      <p>Make sure you aren't charging taxes or shipping for any of these products!</p>
      <table class="table table-striped table-hover">
        <tbody>
          <% @products.each do |product| %>
            <tr>
              <td>
                <a href=<%="#{current_shop_url}/admin/products/#{product.product_id}"%> target="_blank"> <%= product.product_id %> </a>
              </td>
              <td>
                <form method="POST" action="/products">
                  <input type="hidden" name="_method" value="delete" />
                  <input type="hidden" name="id" value="<%= product.id %>" />
                  <input type="submit" class="btn btn-default align-right" value="delete">
                </form>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p> No products are currently setup for tax receipts. Visit the <a href="/help">help page</a> to see how to get started!</p>
    <% end %>
  </div>
  <div id="push"></div>
</div>

<div id="footer">
  <div class="container">
    <p class="muted credit" style="margin-top: 20px;">Need Help? Visit the <a href="/help">help page</a></p>
  </div>
</div>
